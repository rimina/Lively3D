/*!
Copyright (C) 2012 Jari-Pekka Voutilainen

Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the "Software"), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
of the Software, and to permit persons to whom the Software is furnished to do
so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

*/
typeof Lively3D=="undefined"&&(Lively3D={});var Lively3D=function(e){var t="",n="canvas";e.THREE={renderer:null,camera:null,scene:null},e.WIDGET={mainWindow:null};var r=[],i=0,s={Id:"mainscene",Model:null,Icon:null,Controlls:null,Clk:null,Init:function(){this.Model=new THREEJS_WIDGET3D.GridWindow(2e3,2e3,6980693..toString(16)),this.Model.addEventListener(WIDGET3D.EventType.onmousedown,this.Model.mousedownHandler,this.Model),this.Model.addEventListener(WIDGET3D.EventType.onmouseup,this.Model.mouseupHandler,this.Model),this.Model.addEventListener(WIDGET3D.EventType.onmousemove,this.Model.mousemoveHandler,this.Model),this.Controlls=new THREE.FirstPersonControls(e.THREE.camera,e.THREE.renderer.domElement),this.Clk=new THREE.Clock,e.THREE.camera.lookAt(this.Model.getLocation()),console.log(this.Controlls)},CreateIcon:function(){var e=THREE.ImageUtils.loadTexture("../images/app.png");return this.Icon=new THREEJS_WIDGET3D.GridIcon(e,this.Model),this.Icon},RenderingFunction:function(e,t){this.Model.update(),this.Controlls.update(this.Clk.getDelta())},Open:function(e,t){u==0&&(this.Controlls.freeze=!0)},Close:function(t,n){u==0&&(this.Controlls.freeze=!1,e.THREE.camera.lookAt(this.Model.getLocation()))}},o=[],u=0;e.Init=function(u){function c(){requestAnimFrame(c,u),l=parseInt((new Date).getTime()),r[i].RenderingFunction(l,f);for(var t=0;t<o.length;++t)o[t].GetWindowObject().update();e.THREE.renderer.render(e.THREE.scene,e.THREE.camera),f=l}var a=$("<h1>Enter Username</h1>Username: <input type='text' name='username' id='username'/><h3 onclick='Lively3D.UI.EnterUsername()'>Ok</h3>");e.UI.ShowHTML(a,!0),u?t=u:t=n;var u=document.getElementById(t);e.THREE.renderer=new THREE.WebGLRenderer({canvas:u,antialias:!0,autoClear:!1}),e.THREE.renderer.setClearColorHex(16382457,1),e.THREE.renderer.setSize(u.width,u.height),e.THREE.scene=new THREE.Scene,e.THREE.camera=new THREE.PerspectiveCamera(75,u.width/u.height,1,1e4),e.THREE.camera.position.z=3e3,e.THREE.scene.add(e.THREE.camera),e.THREE.scene.add(new THREE.AmbientLight(4210752)),e.WIDGET.mainWindow=THREEJS_WIDGET3D.init(e.THREE.scene,e.THREE.renderer,e.THREE.camera),r.push(s),r[i].Init(),e.WIDGET.mainWindow.addChild(r[i].Model);var f=0,l;c()};var a=function(){};e.AddApplication=function(t,n,s){var u=new e.Application;o.push(u),u.SetName(t).SetApplicationCode(n).SetInitializationCode(s);var a=s(n),h=a.GetCanvas();u.SetStart(a.StartApp);var p=r[i].CreateIcon(),d=new THREE.Texture(h),v=new THREE.MeshBasicMaterial({map:d});d.needsUpdate=!0;var m=new THREEJS_WIDGET3D.TitledWindow(t,1500,1500,v);e.WIDGET.mainWindow.addChild(m),m.title_.addEventListener(WIDGET3D.EventType.onmousedown,m.mousedownHandler,m),m.title_.addEventListener(WIDGET3D.EventType.onmouseup,m.mouseupHandler,m),m.title_.addEventListener(WIDGET3D.EventType.onmousemove,m.mousemoveHandler,m);var g=function(e){e.mesh_.material.map&&(e.mesh_.material.map.needsUpdate=!0)};return m.addUpdateCallback(g,m),m.setZ(1e3),m.hide(),u.SetWindowObject(m),a.GetState&&u.SetSave(a.GetState),a.SetState&&u.SetLoad(a.SetState),a.Open&&u.SetAppOpen(a.Open),a.Close&&u.SetAppClose(a.Close),a.SetLivelyApp(u),p.addEventListener(WIDGET3D.EventType.ondblclick,l,u),m.closeButton_.addEventListener(WIDGET3D.EventType.onclick,f,u),c(m,a.EventListeners,u),u};var f=function(t,n){e.Close(n)},l=function(t,n){e.Open(n)},c=function(e,t,n){if(e&&t){var r=!1,i=!1,s=!1,o=!1;for(var u in t)h(e,u,t,n),u=="click"?r=!0:u=="mousedown"?i=!0:u=="mouseup"?s=!0:u=="mousemove"&&(o=!0);!r&&!i&&e.addEventListener(WIDGET3D.EventType.onclick,p,{app:n,callback:!1}),s||e.addEventListener(WIDGET3D.EventType.onmouseup,p,{app:n,callback:!1}),o||e.addEventListener(WIDGET3D.EventType.onmousemove,p,{app:n,callback:!1})}},h=function(e,t,n,r){switch(t){case"click":return e.addEventListener(WIDGET3D.EventType.onclick,p,{app:r,callback:n.click}),!0;case"dblclick":return e.addEventListener(WIDGET3D.EventType.ondblclick,p,{app:r,callback:n.dblclick}),!0;case"mousemove":return e.addEventListener(WIDGET3D.EventType.onmousemove,p,{app:r,callback:n.mousemove}),!0;case"mousedown":return e.addEventListener(WIDGET3D.EventType.onmousedown,p,{app:r,callback:n.mousedown}),!0;case"mouseup":return e.addEventListener(WIDGET3D.EventType.onmouseup,p,{app:r,callback:n.mouseup}),!0;case"mouseover":return e.addEventListener(WIDGET3D.EventType.onmouseover,p,{app:r,callback:n.mouseover}),!0;case"mouseout":return e.addEventListener(WIDGET3D.EventType.onmouseout,p,{app:r,callback:n.mouseout}),!0;case"keypress":return e.addEventListener(WIDGET3D.EventType.onkeypress,n.keypress),!0;case"keydown":return e.addEventListener(WIDGET3D.EventType.onkeydown,n.keydown),!0;case"keyup":return e.addEventListener(WIDGET3D.EventType.onkeyup,n.keyup),!0;default:return console.log("default: "+t),!1}},p=function(e,t){var n=t.app.GetWindowObject();e.type=="click"||e.type=="mousedown"?n.focus():e.type=="mouseup"?n.mouseupHandler(e,n):e.type=="mousemove"&&n.mousemoveHandler(e,n);if(t.callback){var r=(n.mousePosition_.x- -n.width_/2)/n.width_,i=(n.mousePosition_.z- -n.height_/2)/n.height_,s=n.mesh_.material.map.image.width,o=n.mesh_.material.map.image.height,u=r*s,a=i*o,f=[u,a],l={coord:f,canvas:n.mesh_.material.map.image,event:e};t.callback(l)}};e.Open=function(e){r[i].Open(e,null),e.Open(),e.GetWindowObject().show(),e.GetWindowObject().focus(),++u},e.Close=function(e){--u,e.Close(),e.GetWindowObject().hide(),r[i].Close(e,null)},e.GetCurrentSceneIndex=function(){return i},e.FileOperations={},e.FileOperations.getScript=function(e,t){$.get("getFile.php",{name:e,path:t},function(e){var t=document.createElement("script");t.type="text/javascript",t.src=e,document.head.appendChild(t)})},e.FileOperations.uploadScript=function(e,t,n){$.post("uploadfile.php",{name:e,file:t,path:n},function(){console.log("uploaded script: "+e)})},e.FileOperations.getJSON=function(e,t,n){$.get("getFile.php",{name:e,JSON:!0,path:n},function(e){$.getJSON(e,t)})},e.FileOperations.LoadResources=function(e,t){$.get("getFileArray.php",{"names[]":e.Resources[t],path:e.ResourcePath},function(n){var r=JSON.parse(n);e.ResourceHandlers[t](r),e.ResourcesLoaded(t)})},e.AllowAppStart=function(t){t.StateFromDropbox==1&&(t.OpenAfterLoad==1&&e.Open(t),t.MaximizeAfterLoad==1&&e.Maximize(t)),e.UI.ShowLoadCompleted()};var d=[];e.AddScene=function(t){console.log("Loading scene.."),d.push(t),t.Resources.Document="Document/"+t.File,t.ResourceHandlers.Document=function(t){e.GLGE.document.loadDocument(t[0])},e.LoadResources(t)};var v=function(t){var n=m(t);console.log("scene loaded from url: "+t+" and file is "+n.file);var i=!1;for(var s in d)d.hasOwnProperty(s)&&d[s].File==n.file&&(d[s].DocumentDone&&d[s].DocumentDone(),r.push((new e.Scene).SetScene(e.GLGE.document.getElement(d[s].Id)).SetModel(d[s])),AddAppsToScene(d[s]),d.splice(s,1),i=!0);i==0&&console.log("error loading scene")},m=function(e){var t=/((http|ftp):\/)?\/?([^:\/\s]+)((\/\w+)*\/)([\w\-\.]+\.[^#?\s]+)(#[\w\-]+)?/;return e.match(t)?{url:RegExp["$&"],protocol:RegExp.$2,host:RegExp.$3,path:RegExp.$4,file:RegExp.$6,hash:RegExp.$7}:{url:"",protocol:"",host:"",path:"",file:"",hash:""}};e.GetCurrentScene=function(){return r[i]},e.GetApplications=function(){return o},e.ChangeScene=function(){i+=1,i==r.length&&(i=0)},e.LoadCompleted=function(){e.UI.ShowLoadCompleted()},e.Sync=function(){e.Proxies.Local.CheckAvailability(function(){e.Proxies.Local.Sync()})},e.LoadResources=function(t){for(var n in t.Resources)t.Resources.hasOwnProperty(n)&&(e.UI.HTTPServers.LOCAL.inUse==1?e.Proxies.Local.LoadResources(t,n):(e.UI.HTTPServers.PROXY.inUse==1||e.UI.HTTPServers.NODE.inUse==1)&&e.FileOperations.LoadResources(t,n))};var g;return e.SetUsername=function(e){g=e},e.GetUsername=function(){return g},e}(Lively3D);(function(e){e.Application=function(){this.Save=function(){var e={};return e},this.Load=function(e){};var e=!0;this.isClosed=function(){return e};var t=function(){};this.Close=function(){e=!0,t()},this.SetAppClose=function(e){return t=e,this};var n=function(){};this.Open=function(){e=!1,n()},this.SetAppOpen=function(e){return n=e,this};var r=!1;this.isMaximized=function(){return r},this.Maximize=function(){r=!0},this.Minimize=function(){r=!1};var i=[];this.AddSceneObject=function(e){return i.push(e),o==null&&(o=e),this};var s;this.SetWindowObject=function(e){return s=e,this},this.GetWindowObject=function(){return s};var o;this.GetCurrentSceneObject=function(){return o},this.SetCurrentSceneObject=function(e){e!=null&&e>=0&&e<i.length?o=i[e]:console.log("No such scene object")},this.GetSceneObject=function(e){if(e!=null&&e>=0&&e<i.length)return i[e].group;console.log("No such scene object")};var u;this.SetName=function(e){return u=e,this},this.GetName=function(){return u};var a;this.SetApplicationCode=function(e){return a=e,this},this.GetApplicationCode=function(){return a};var f;this.SetInitializationCode=function(e){return f=e,this},this.GetInitializationCode=function(){return f},this.SetSave=function(e){return this.Save=e,this},this.SetLoad=function(e){return this.Load=e,this},this.SetStart=function(e){return this.StartApp=e,this}}})(Lively3D),function(e){e.Scene=function(){var e;this.SetModel=function(t){return e=t,this},this.GetModel=function(){return e};var t;this.SetScene=function(e){return t=e,this},this.GetScene=function(){return t}}}(Lively3D),function(e){e.UI={},e.UI.HTTPServers={LOCAL:{inUse:!1},NODE:{inUse:!1},PROXY:{inUse:!0}},e.UI.ToggleNode=function(){e.UI.HTTPServers.NODE.inUse=!e.UI.HTTPServers.NODE.inUse,e.UI.HTTPServers.PROXY.inUse=!e.UI.HTTPServers.PROXY.inUse},e.UI.UseLocal=function(){console.log("Going offline..."),e.UI.HTTPServers.LOCAL.inUse=!0},e.UI.UseOnline=function(){console.log("Going online..."),e.UI.HTTPServers.LOCAL.inUse=!1},e.UI.ShowLoadCompleted=function(){var e=$("<div id='loadcompleted'><p>Load Compeleted</p></div>");e.appendTo("#container"),e.fadeIn("slow",function(){setTimeout(function(){e.fadeOut("slow",function(){e.remove()})},1e3)})},e.UI.ShowAppList=function(){this.HTTPServers.LOCAL.inUse==1?e.Proxies.Local.ShowAppList():this.HTTPServers.PROXY.inUse==1?e.Proxies.PHP.ShowAppList():e.Proxies.Node.ShowAppList()},e.UI.LoadApplication=function(t){this.HTTPServers.LOCAL.inUse==1?e.Proxies.Local.LoadApplication(t):this.HTTPServers.PROXY.inUse==1?e.Proxies.PHP.LoadApplication(t):e.Proxies.Node.LoadApplication(t)},e.UI.ShowStateList=function(){this.HTTPServers.LOCAL.inUse==1?e.Proxies.Local.ShowStateList():this.HTTPServers.PROXY.inUse==1?e.Proxies.PHP.ShowStateList():e.Proxies.Node.ShowStateList()},e.UI.ShowSceneList=function(){this.HTTPServers.LOCAL.inUse==1?e.Proxies.Local.ShowSceneList():this.HTTPServers.PROXY.inUse==1?e.Proxies.PHP.ShowSceneList():e.Proxies.Node.ShowSceneList()},e.UI.LoadScene=function(t){this.HTTPServers.LOCAL.inUse==1?e.Proxies.Local.LoadScene(t):this.HTTPServers.PROXY.inUse==1?e.Proxies.PHP.LoadScene(t):e.Proxies.Node.LoadScene(t)},e.UI.SaveDesktop=function(t){this.HTTPServers.LOCAL.inUse==1?e.Proxies.Local.SaveDesktop(t):this.HTTPServers.PROXY.inUse==1?e.Proxies.PHP.SaveDesktop(t):e.Proxies.Node.SaveDesktop(t)},e.UI.LoadDesktop=function(t){this.HTTPServers.LOCAL.inUse==1?(e.Proxies.Local.LoadDesktop(t),e.UI.CloseDialog()):this.HTTPServers.PROXY.inUse==1?(e.Proxies.PHP.LoadDesktop(t),e.UI.CloseDialog()):(e.Proxies.Node.LoadDesktop(t),e.UI.CloseDialog())};var t;e.UI.ShowSaveDialog=function(){var n=$('<h1>Save state</h1>State name:<input type="text" name="statename" id="statename"/><h3 onclick="Lively3D.UI.CloseSaveDialog();">Save</h3>');this.ShowHTML(n),t=e.GLGE.clickedObject,e.GLGE.clickedObject=null},e.UI.CloseSaveDialog=function(){var n=$("#statename");n[0].value.length!=0?(e.UI.SaveDesktop(n[0].value),this.CloseDialog(),t&&(e.GLGE.clickedObject=t,t=null)):$("<h3>Please supply state name</h3>").appendTo("#dialog")},e.UI.ShowAbout=function(){var e=$("<h1>About</h1><p>Lively3D code made by Jari-Pekka Voutilainen</p><p>Applications developed by: Arto Salminen, Matti Anttonen, Anna-Liisa Mattila, Lotta Liikkanen, Jani Heininen, Mika V�lim�ki</p>");this.ShowHTML(e)},e.UI.ShowMessage=function(e){var t=$("<p>"+e+"</p>");this.ShowHTML(t)},e.UI.ActiveDialog,e.UI.ShowHTML=function(e,t){if(this.ActiveDialog!=null)this.ActiveDialog.cancelOmitted!=1&&n(e);else{if(t!=1)var r=$("<div class='dialog' id='dialog'><h3 onclick='Lively3D.UI.CloseDialog();'>Cancel</h3></div>");else{var r=$("<div class='dialog' id='dialog'></div>");r.cancelOmitted=!0}r.prepend(e),r.appendTo($("#container")),r.fadeIn("slow"),this.ActiveDialog=r}},e.UI.CloseDialog=function(){this.ActiveDialog.fadeOut("slow",function(){e.UI.ActiveDialog.remove(),e.UI.ActiveDialog=null})};var n=function(t){e.UI.ActiveDialog.fadeOut("fast",function(){e.UI.ActiveDialog.remove();var n=$("<div class='dialog' id='dialog'><h3 onclick='Lively3D.UI.CloseDialog();'>Cancel</h3></div>");n.prepend(t),n.appendTo($("#container")),n.fadeIn("fast"),e.UI.ActiveDialog=n})};e.UI.EnterUsername=function(){var t=$("#username");t[0].value.length!=0?(e.SetUsername(t[0].value),this.CloseDialog()):$("<h3>Please enter username</h3>").appendTo("#dialog")}}(Lively3D),function(Lively3D){Lively3D.Proxies={},Lively3D.Proxies.PHP={ShowAppList:function(){$.get("getFileList.php",{path:"apps"},function(e){var t=JSON.parse(e),n=$("<h1>Select Application</h1><div></div>"),r=n.last();for(var i in t)if(t.hasOwnProperty(i)){var s=$("<span onclick=\"Lively3D.UI.LoadApplication('"+t[i]+"')\">"+t[i]+"</span></br>");s.appendTo(r)}Lively3D.UI.ShowHTML(n)})},LoadApplication:function(e){Lively3D.FileOperations.getScript(e,"apps/"),Lively3D.UI.CloseDialog()},SaveDesktop:function(e){var t=Lively3D.GetApplications(),n="",r=[];for(var i in t)if(t.hasOwnProperty(i)){var s=t[i],o=s.isMaximized();s.isMaximized()==1&&Lively3D.Minimize(s);var u={Name:s.GetName(),Location:{x:s.GetCurrentSceneObject().getLocX(),y:s.GetCurrentSceneObject().getLocY(),z:s.GetCurrentSceneObject().getLocZ()},Rotation:s.GetCurrentSceneObject().getRotation(),Closed:s.isClosed(),Maximized:o,Code:s.GetApplicationCode().toString(),Init:s.GetInitializationCode().toString(),AppState:s.Save()};r.push(u),o==1&&Lively3D.Maximize(s)}n=JSON.stringify(r),Lively3D.FileOperations.uploadScript(e,n,"states/"+Lively3D.GetUsername())},LoadDesktop:function(e){Lively3D.FileOperations.getJSON(e,ParseDesktopJSON,"states/"+Lively3D.GetUsername()+"/")},ShowStateList:function(){$.get("getFileList.php",{path:"states/"+Lively3D.GetUsername()},function(e){var t=JSON.parse(e),n=$("<h1>Select State</h1><div></div>"),r=n.last();for(var i in t)if(t.hasOwnProperty(i)){var s=$("<span onclick=\"Lively3D.UI.LoadDesktop('"+t[i]+"')\">"+t[i]+"</span></br>");s.appendTo(r)}Lively3D.UI.ShowHTML(n)})},ShowSceneList:function(){$.get("getFileList.php",{path:"scenes"},function(e){var t=JSON.parse(e),n=$("<h1>Select Scene</h1><div></div>"),r=n.last();for(var i in t)if(t.hasOwnProperty(i)){var s=$("<span onclick=\"Lively3D.UI.LoadScene('"+t[i]+"')\">"+t[i]+"</span></br>");s.appendTo(r)}Lively3D.UI.ShowHTML(n)})},LoadScene:function(e){Lively3D.FileOperations.getScript(e,"scenes/"),Lively3D.UI.CloseDialog()}};var ParseDesktopJSON=function(data){var JSONArray=JSON.parse(data);for(var i in JSONArray)if(JSONArray.hasOwnProperty(i)){var JSONObject=JSONArray[i],CodeFunc=eval("("+JSONObject.Code+")"),InitFunc=eval("("+JSONObject.Init+")"),app=Lively3D.AddApplication(JSONObject.Name,CodeFunc,InitFunc);SetAppLocation(app,JSONObject.Location),SetAppRotation(app,JSONObject.Rotation),app.StateFromDropbox=!0,JSONObject.Closed!=1&&(app.OpenAfterLoad=!0),JSONObject.Maximized==1&&(app.MaximizeAfterLoad=!0),app.Load(JSONObject.AppState),app.StartApp()}},SetAppLocation=function(e,t){e.GetSceneObject(0).setLocX(t.x),e.GetSceneObject(0).setLocY(t.y),e.GetSceneObject(0).setLocZ(t.z)},SetAppRotation=function(e,t){e.GetSceneObject(0).setRotX(t.x),e.GetSceneObject(0).setRotY(t.y),e.GetSceneObject(0).setRotZ(t.z)};Lively3D.Proxies.Node={ShowAppList:function(){$.get("/lively3d/node/filelist/apps",function(e){var t=$("<h1>Select Application</h1><div></div>"),n=t.last();for(var r in e)if(e.hasOwnProperty(r)){var i=$("<span onclick=\"Lively3D.UI.LoadApplication('"+e[r]+"')\">"+e[r]+"</span></br>");i.appendTo(n)}Lively3D.UI.ShowHTML(t)})},LoadApplication:function(e){$.get("/lively3d/node/file/apps/"+e,function(e){var t=document.createElement("script");t.type="text/javascript",t.src=e,document.head.appendChild(t)}),Lively3D.UI.CloseDialog()},SaveDesktop:function(e){var t=Lively3D.GetApplications(),n={};n.name=e,n.user=Lively3D.GetUsername(),n.applications=[];for(var r in t)if(t.hasOwnProperty(r)){var i=t[r],s=i.isMaximized();i.isMaximized()==1&&Lively3D.Minimize(i);var o={Name:i.GetName(),Location:{x:i.GetCurrentSceneObject().getLocX(),y:i.GetCurrentSceneObject().getLocY(),z:i.GetCurrentSceneObject().getLocZ()},Rotation:i.GetCurrentSceneObject().getRotation(),Closed:i.isClosed(),Maximized:s,Code:i.AppCode.toString(),Init:i.AppInit.toString(),AppState:i.Save()};n.applications.push(o),s==1&&Lively3D.Maximize(i)}$.post("/lively3d/node/states/new",{state:n},function(e){console.log(e)})},LoadDesktop:function(name){var Applications=Lively3D.GetApplications(),appcount=Applications.length;for(var i=0;i<appcount;++i){for(var i in Lively3D.GLGE.scenes)Lively3D.GLGE.scenes.hasOwnProperty(i)&&Lively3D.GLGE.scenes[i].scene.removeChild(Applications[i].current);Applications.splice(0,1)}$.get("/lively3d/node/states/"+Lively3D.GetUsername()+"/"+name,function(data){var apps=data.applications;for(var i in apps)if(apps.hasOwnProperty(i)){var JSONObject=apps[i],CodeFunc=eval("("+JSONObject.Code+")"),InitFunc=eval("("+JSONObject.Init+")"),app=Lively3D.AddApplication(JSONObject.Name,CodeFunc,InitFunc);SetAppLocation(app,JSONObject.Location),SetAppRotation(app,JSONObject.Rotation),app.StateFromDropbox=!0,JSONObject.Closed!="true"&&(app.OpenAfterLoad=!0),JSONObject.Maximized=="true"&&(app.MaximizeAfterLoad=!0),app.Load(JSONObject.AppState),app.StartApp()}})},ShowStateList:function(){$.get("/lively3d/node/states/"+Lively3D.GetUsername(),function(e){var t=$("<h1>Select State</h1><div></div>"),n=t.last();for(var r in e)if(e.hasOwnProperty(r)){var i=$("<span onclick=\"Lively3D.UI.LoadDesktop('"+e[r]+"')\">"+e[r]+"</span></br>");i.appendTo(n)}Lively3D.UI.ShowHTML(t)})},ShowSceneList:function(){$.get("/lively3d/node/filelist/scenes",function(e){var t=$("<h1>Select Scene</h1><div></div>"),n=t.last();for(var r in e)if(e.hasOwnProperty(r)){var i=$("<span onclick=\"Lively3D.UI.LoadScene('"+e[r]+"')\">"+e[r]+"</span></br>");i.appendTo(n)}Lively3D.UI.ShowHTML(t)})},LoadScene:function(e){$.get("/lively3d/node/file/scenes/"+e,function(e){var t=document.createElement("script");t.type="text/javascript",t.src=e,document.head.appendChild(t)}),Lively3D.UI.CloseDialog()}},Lively3D.Proxies.Local={ShowAppList:function(){$.ajax({url:"http://127.0.0.1:8000/filelist/apps",success:function(e){var t=$("<h1>Select Application</h1><div></div>"),n=t.last();for(var r in e)if(e.hasOwnProperty(r)){var i=$("<span onclick=\"Lively3D.UI.LoadApplication('"+e[r]+"')\">"+e[r]+"</span></br>");i.appendTo(n)}Lively3D.UI.ShowHTML(t)}})},LoadApplication:function(e){$.get("http://127.0.0.1:8000/file/apps/"+e,function(e){var t=document.createElement("script");t.type="text/javascript",t.src=e,document.head.appendChild(t)}),Lively3D.UI.CloseDialog()},ShowSceneList:function(){$.get("http://localhost:8000/filelist/scenes",function(e){var t=$("<h1>Select Scene</h1><div></div>"),n=t.last();for(var r in e)if(e.hasOwnProperty(r)){var i=$("<span onclick=\"Lively3D.UI.LoadScene('"+e[r]+"')\">"+e[r]+"</span></br>");i.appendTo(n)}Lively3D.UI.ShowHTML(t)})},LoadScene:function(e){$.get("http://localhost:8000/file/scenes/"+e,function(e){var t=document.createElement("script");t.type="text/javascript",t.src=e,document.head.appendChild(t)}),Lively3D.UI.CloseDialog()},CheckAvailability:function(e){$.ajax({url:"http://localhost:8000/",success:function(t){t.success==0?Lively3D.UI.ShowMessage(t.message):e()},error:function(){Lively3D.UI.ShowMessage("Local Node.js application not found. Please run 'node local.js'")}})},Sync:function(e){$.ajax({url:"http://localhost:8000/sync",data:{host:window.location.host,port:window.location.port,path:window.location.pathname},success:function(e){e.success==1&&Lively3D.UI.ShowMessage(e.message)},error:function(){Lively3D.UI.ShowMessage("Local Node.js application not found. Please run 'node local.js' and associated Mongo-database.")}})},LoadResources:function(e,t){$.get("http://localhost:8000/filearray",{"names[]":e.Resources[t],path:e.ResourcePath},function(n){e.ResourceHandlers[t](n),e.ResourcesLoaded(t)})}}}(Lively3D)