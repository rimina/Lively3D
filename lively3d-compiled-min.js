/*!
Copyright (C) 2012 Jari-Pekka Voutilainen

Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the "Software"), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
of the Software, and to permit persons to whom the Software is furnished to do
so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

*/
typeof Lively3D=="undefined"&&(Lively3D={});var Lively3D=function(e){var t="",n="canvas";e.THREE={renderer:null,camera:null},e.WIDGET={mainWindow:null,cameraGroup:null,addToCameraGroup:function(e){if(this.cameraGroup){var t=this.cameraGroup.getRot(),n=this.cameraGroup.getLocation();this.cameraGroup.setLocation(0,0,0),this.cameraGroup.setRot(0,0,0),this.cameraGroup.addChild(e),this.cameraGroup.setLocation(n.x,n.y,n.z),this.cameraGroup.setRot(t.x,t.y,t.z)}}};var r=[],i=0,s={Id:"mainscene",Model:null,Init:function(){this.Model=new THREEJS_WIDGET3D.GridWindow({width:2e3,height:2e3,color:6980693,defaultControls:!0}),this.Model.setZ(200),e.WIDGET.mainWindow.addChild(this.Model)},CreateApplication:function(e){var t=new THREEJS_WIDGET3D.GridIcon({picture:"../images/app.png",color:61013,parent:this.Model});return t},RenderingFunction:function(e,t){this.Model.update()},Open:function(e,t){},Close:function(e,t){},Remove:function(){this.Model.remove()}},o=[];e.Init=function(u){function l(){requestAnimFrame(l,u),f=parseInt((new Date).getTime()),r[i].GetScene().RenderingFunction(f,a);for(var e=0;e<o.length;++e){var t=o[e].GetWindowObject();t.isVisible_&&t.update()}THREEJS_WIDGET3D.render(),a=f}u?t=u:t=n;var u=document.getElementById(t);e.THREE.renderer=new THREE.WebGLRenderer({canvas:u,antialias:!0,autoClear:!1}),e.THREE.renderer.setClearColorHex(16382457,1),e.THREE.renderer.setSize(u.width,u.height),e.WIDGET.mainWindow=THREEJS_WIDGET3D.init({renderer:e.THREE.renderer}),e.WIDGET.cameraGroup=new WIDGET3D.Window,e.WIDGET.mainWindow.addChild(e.WIDGET.cameraGroup),e.THREE.camera=THREEJS_WIDGET3D.camera,e.WIDGET.cameraGroup.container_.add(e.THREE.camera),e.WIDGET.cameraGroup.setZ(2800),r.push((new e.Scene).SetScene(s)),r[i].GetScene().Init(),r[i].SetModel(r[i].GetScene().Model),e.UI.create(r[i]);var a=0,f;l()},e.AddApplication=function(t,n,s){var c=new e.Application;o.push(c),c.SetName(t).SetApplicationCode(n).SetInitializationCode(s);var h=s(n),p=h.GetCanvas();c.SetStart(h.StartApp);var d=new THREE.Texture(p),v=new THREE.MeshBasicMaterial({map:d});d.needsUpdate=!0;var m=new THREEJS_WIDGET3D.TitledWindow({title:t,width:1500,height:1500,material:v,defaultControls:!0});m.setZ(-1800),e.WIDGET.addToCameraGroup(m);var g=r[i].GetScene().CreateApplication(p),y=function(e){e.mesh_.material.map&&(e.mesh_.material.map.needsUpdate=!0)};return m.addUpdateCallback(y,m),m.hide(),c.SetWindowObject(m),c.SetIcon(g),h.GetState&&c.SetSave(h.GetState),h.SetState&&c.SetLoad(h.SetState),h.Open&&c.SetAppOpen(h.Open),h.Close&&c.SetAppClose(h.Close),h.SetLivelyApp(c),g.addEventListener(WIDGET3D.EventType.ondblclick,a,c),m.closeButton_.addEventListener(WIDGET3D.EventType.onclick,u,c),m.title_.addEventListener(WIDGET3D.EventType.ondblclick,f,c),l(m,h.EventListeners,c),c};var u=function(t,n){e.Close(n)},a=function(t,n){e.Open(n)},f=function(e,t){t.isMaximized()?t.Minimize():t.Maximize()};e.Maximize=function(t){var n=t.getLocation(),r={z:e.THREE.camera.position.z-n.z};t.d=r,t.setZ(n.z+.3*r.z)},e.Minimize=function(e){var t=e.getLocation();e.setZ(t.z-.3*e.d.z)};var l=function(e,t,n){if(e&&t){var r=!1,i=!1,s=!1,o=!1;for(var u in t)c(e,u,t,n),u=="click"?r=!0:u=="mousedown"&&(i=!0);!r&&!i&&e.addEventListener(WIDGET3D.EventType.onclick,h,{app:n,callback:!1})}},c=function(e,t,n,r){switch(t){case"click":return e.addEventListener(WIDGET3D.EventType.onclick,h,{app:r,callback:n.click}),!0;case"dblclick":return e.addEventListener(WIDGET3D.EventType.ondblclick,h,{app:r,callback:n.dblclick}),!0;case"mousemove":return e.addEventListener(WIDGET3D.EventType.onmousemove,h,{app:r,callback:n.mousemove}),!0;case"mousedown":return e.addEventListener(WIDGET3D.EventType.onmousedown,h,{app:r,callback:n.mousedown}),!0;case"mouseup":return e.addEventListener(WIDGET3D.EventType.onmouseup,h,{app:r,callback:n.mouseup}),!0;case"mouseover":return e.addEventListener(WIDGET3D.EventType.onmouseover,h,{app:r,callback:n.mouseover}),!0;case"mouseout":return e.addEventListener(WIDGET3D.EventType.onmouseout,h,{app:r,callback:n.mouseout}),!0;case"keypress":return e.addEventListener(WIDGET3D.EventType.onkeypress,n.keypress),!0;case"keydown":return e.addEventListener(WIDGET3D.EventType.onkeydown,n.keydown),!0;case"keyup":return e.addEventListener(WIDGET3D.EventType.onkeyup,n.keyup),!0;default:return console.log("default: "+t),!1}},h=function(e,t){var n=t.app.GetWindowObject();(e.type=="click"||e.type=="mousedown")&&n.focus();if(t.callback){var r=(n.mousePosition_.x- -n.width_/2)/n.width_,i=(n.mousePosition_.z- -n.height_/2)/n.height_,s=n.mesh_.material.map.image.width,o=n.mesh_.material.map.image.height,u=r*s,a=i*o,f=[u,a],l={coord:f,canvas:n.mesh_.material.map.image,event:e};t.callback(l)}};e.Open=function(e){r[i].GetScene().Open(e),e.Open(),e.GetWindowObject().show(),e.GetWindowObject().focus()},e.Close=function(e){var t=e.GetWindowObject();e.isMaximized()&&e.Minimize(),e.Close(),t.hide(),r[i].GetScene().Close(e)},e.GetCurrentSceneIndex=function(){return i},e.FileOperations={},e.FileOperations.getScript=function(e,t){$.get("getFile.php",{name:e,path:t},function(e){var t=document.createElement("script");t.type="text/javascript",t.src=e,document.head.appendChild(t)})},e.FileOperations.uploadScript=function(e,t,n){$.post("uploadfile.php",{name:e,file:t,path:n},function(){console.log("uploaded script: "+e)})},e.FileOperations.getJSON=function(e,t,n){$.get("getFile.php",{name:e,JSON:!0,path:n},function(e){$.getJSON(e,t)})},e.FileOperations.LoadResources=function(e,t){$.get("getFileArray.php",{"names[]":e.Resources[t],path:e.ResourcePath},function(n){var r=JSON.parse(n);e.ResourceHandlers[t](r),e.ResourcesLoaded(t)})},e.AllowAppStart=function(t){t.StateFromDropbox==1&&(t.OpenAfterLoad==1&&e.Open(t),t.MaximizeAfterLoad==1&&t.Maximize()),e.LoadCompleted()};var p=[];e.AddScene=function(t){console.log("Loading scene.."),p.push(t),e.LoadResources(t)},e.SceneLoader=function(){var t=!1;for(var n in p)p.hasOwnProperty(n)&&(r.push((new e.Scene).SetScene(p[n])),console.log(p[n]),p.splice(n,1),t=!0,e.LoadCompleted());t==0&&console.log("error loading scene")},e.GetCurrentScene=function(){return r[i]},e.GetApplications=function(){return o},e.ChangeScene=function(t,n){for(var s in o)o.hasOwnProperty(s)&&(o[s].isClosed()||e.Close(o[s]));r[i].GetScene().Remove(),i+=1,i==r.length&&(i=0),r[i].GetScene().Init(),r[i].SetModel(r[i].GetScene().Model);for(var s in o){var u=r[i].GetScene().CreateApplication(o[s].GetWindowObject().mesh_.material.map.image);u.addEventListener(WIDGET3D.EventType.ondblclick,a,o[s]),o[s].SetIcon(u)}},e.LoadCompleted=function(){e.UI.ShowLoadCompleted()},e.Sync=function(t){e.Proxies.Local.CheckAvailability(function(){e.Proxies.Local.Sync()})},e.LoadResources=function(t){for(var n in t.Resources)t.Resources.hasOwnProperty(n)&&(e.UI.HTTPServers.LOCAL.inUse==1?e.Proxies.Local.LoadResources(t,n):(e.UI.HTTPServers.PROXY.inUse==1||e.UI.HTTPServers.NODE.inUse==1)&&e.FileOperations.LoadResources(t,n))};var d;return e.SetUsername=function(e){d=e},e.GetUsername=function(){return d},e}(Lively3D);(function(e){e.Application=function(){this.Save=function(){var e={};return e},this.Load=function(e){};var t=!0;this.isClosed=function(){return t};var n=function(){};this.Close=function(){t=!0,n()},this.SetAppClose=function(e){return n=e,this};var r=function(){};this.Open=function(){t=!1,r()},this.SetAppOpen=function(e){return r=e,this};var i=!1;this.isMaximized=function(){return i},this.Maximize=function(){i=!0,e.Maximize(o)},this.Minimize=function(){i=!1,e.Minimize(o)};var s;this.SetIcon=function(e){s=e},this.GetIcon=function(){return s};var o;this.SetWindowObject=function(e){return o=e,this},this.GetWindowObject=function(){return o};var u;this.SetName=function(e){return u=e,this},this.GetName=function(){return u};var a;this.SetApplicationCode=function(e){return a=e,this},this.GetApplicationCode=function(){return a};var f;this.SetInitializationCode=function(e){return f=e,this},this.GetInitializationCode=function(){return f},this.SetSave=function(e){return this.Save=e,this},this.SetLoad=function(e){return this.Load=e,this},this.SetStart=function(e){return this.StartApp=e,this}}})(Lively3D),function(e){e.Scene=function(){var e;this.SetModel=function(t){return e=t,this},this.GetModel=function(){return e};var t;this.SetScene=function(e){return t=e,this},this.GetScene=function(){return t}}}(Lively3D),function(e){e.UI={},e.UI.HTTPServers={LOCAL:{inUse:!1},NODE:{inUse:!1},PROXY:{inUse:!0}},e.UI.Dialogs={loadState:null,addApp:null,loadScene:null,about:null,loadCompleted:null,menu:null,node:null,php:null},e.UI.create=function(t){var i=new THREEJS_WIDGET3D.Dialog({text:"Enter Username",buttonText:"Ok",color:11978174,opacity:1});i.setZ(-1300),e.WIDGET.addToCameraGroup(i);var s=function(t,n){n.dialog.textBox_.string_.length>0&&(e.SetUsername(n.dialog.textBox_.string_),n.dialog.remove(),n.scene.show(),e.UI.Dialogs.menu.show())},o=[];o.push({string:"Load Application",onclick:{handler:e.UI.ShowAppList}}),o.push({string:"Save Desktop",onclick:{handler:e.UI.ShowSaveDialog}}),o.push({string:"Load Desktop",onclick:{handler:e.UI.ShowStateList}}),o.push({string:"Load Scene",onclick:{handler:e.UI.ShowSceneList}}),o.push({string:"Switch Scene",onclick:{handler:e.ChangeScene}}),o.push({string:"Toggle Node.js",onclick:{handler:e.UI.ToggleNode}}),o.push({string:"About",onclick:{handler:e.UI.ShowAbout}}),o.push({string:"Sync for local usage",onclick:{handler:e.Sync}}),e.UI.Dialogs.menu=new THREEJS_WIDGET3D.SelectDialog({width:1300,height:3e3,choices:o,color:5406582,opacity:.7}),e.UI.Dialogs.menu.setLocation(-2750,-1e3,-2900),e.UI.Dialogs.menu.setRotX(-Math.PI/100),e.WIDGET.addToCameraGroup(e.UI.Dialogs.menu),i.button_.addEventListener(WIDGET3D.EventType.onclick,s,{dialog:i,scene:t.GetModel()}),n(),r(),e.UI.Dialogs.menu.hide()},e.UI.createAppDialog=function(n){var r=[];for(var i in n)n.hasOwnProperty(i)&&r.push({string:n[i],onclick:{handler:e.UI.LoadApplication,parameters:n[i]}});e.UI.Dialogs.addApp=t(r,"Select Application")},e.UI.createSceneDialog=function(n){var r=[];for(var i in n)n.hasOwnProperty(i)&&r.push({string:n[i],onclick:{handler:e.UI.LoadScene,parameters:n[i]}});e.UI.Dialogs.loadScene=t(r,"Select Skene")},e.UI.createStateDialog=function(n){var r=[];for(var i in n)n.hasOwnProperty(i)&&r.push({string:n[i],onclick:{handler:e.UI.LoadDesktop,parameters:n[i]}});e.UI.Dialogs.loadState=t(r,"Select Desktop")};var t=function(t,n){var r=new THREEJS_WIDGET3D.SelectDialog({width:1e3,height:3200,choices:t,color:5406582,opacity:.7,text:n,hasCancel:!0});return r.setLocation(0,-1600,-2400),e.WIDGET.addToCameraGroup(r),r},n=function(){e.UI.Dialogs.loadCompleted=new WIDGET3D.Basic;var t=THREE.ImageUtils.loadTexture("images/loadCompleted.png"),n=new THREE.MeshBasicMaterial({map:t,color:5406582,opacity:1}),r=new THREE.Mesh(new THREE.PlaneGeometry(2e3,500),n);r.doubleSided=!0,r.flipSided=!0,r.rotation.x=Math.PI/2,r.position.set(0,0,-2400),e.UI.Dialogs.loadCompleted.setMesh(r),e.WIDGET.addToCameraGroup(e.UI.Dialogs.loadCompleted),e.UI.Dialogs.loadCompleted.hide()},r=function(){e.UI.Dialogs.about=new WIDGET3D.Basic;var t=THREE.ImageUtils.loadTexture("images/about.png"),n=new THREE.MeshBasicMaterial({map:t,color:5406582,opacity:1}),r=new THREE.Mesh(new THREE.PlaneGeometry(2e3,2e3),n);r.doubleSided=!0,r.flipSided=!0,r.rotation.x=Math.PI/2,r.position.set(0,0,-2400),e.UI.Dialogs.about.setMesh(r),e.WIDGET.addToCameraGroup(e.UI.Dialogs.about),e.UI.Dialogs.about.hide();var i=function(e,t){t.hide()};e.UI.Dialogs.about.addEventListener(WIDGET3D.EventType.onclick,i,e.UI.Dialogs.about)},i=5;e.UI.ToggleNode=function(t){e.UI.HTTPServers.NODE.inUse=!e.UI.HTTPServers.NODE.inUse,e.UI.HTTPServers.PROXY.inUse=!e.UI.HTTPServers.PROXY.inUse,e.UI.HTTPServers.NODE.inUse?e.UI.Dialogs.menu.changeChoiceText("Toggle PHP",i):e.UI.Dialogs.menu.changeChoiceText("Toggle Node.js",i)},e.UI.UseLocal=function(){console.log("Going offline..."),e.UI.HTTPServers.LOCAL.inUse=!0},e.UI.UseOnline=function(){console.log("Going online..."),e.UI.HTTPServers.LOCAL.inUse=!1},e.UI.ShowLoadCompleted=function(){e.UI.Dialogs.loadCompleted.show(),setTimeout(function(){e.UI.Dialogs.loadCompleted.hide()},1500)},e.UI.ShowAppList=function(t){e.UI.HTTPServers.LOCAL.inUse==1?e.Proxies.Local.ShowAppList():e.UI.HTTPServers.PROXY.inUse==1?e.Proxies.PHP.ShowAppList():e.Proxies.Node.ShowAppList()},e.UI.LoadApplication=function(t,n){e.UI.HTTPServers.LOCAL.inUse==1?e.Proxies.Local.LoadApplication(n):e.UI.HTTPServers.PROXY.inUse==1?e.Proxies.PHP.LoadApplication(n):e.Proxies.Node.LoadApplication(n)},e.UI.ShowStateList=function(t){e.UI.HTTPServers.LOCAL.inUse==1?e.Proxies.Local.ShowStateList():e.UI.HTTPServers.PROXY.inUse==1?e.Proxies.PHP.ShowStateList():e.Proxies.Node.ShowStateList()},e.UI.ShowSceneList=function(t){e.UI.HTTPServers.LOCAL.inUse==1?e.Proxies.Local.ShowSceneList():e.UI.HTTPServers.PROXY.inUse==1?e.Proxies.PHP.ShowSceneList():e.Proxies.Node.ShowSceneList()},e.UI.LoadScene=function(t,n){e.UI.HTTPServers.LOCAL.inUse==1?e.Proxies.Local.LoadScene(n):e.UI.HTTPServers.PROXY.inUse==1?e.Proxies.PHP.LoadScene(n):e.Proxies.Node.LoadScene(n)},e.UI.SaveDesktop=function(t){e.UI.HTTPServers.LOCAL.inUse==1?e.Proxies.Local.SaveDesktop(t):e.UI.HTTPServers.PROXY.inUse==1?e.Proxies.PHP.SaveDesktop(t):e.Proxies.Node.SaveDesktop(t)},e.UI.LoadDesktop=function(t,n){e.UI.HTTPServers.LOCAL.inUse==1?e.Proxies.Local.LoadDesktop(n):e.UI.HTTPServers.PROXY.inUse==1?e.Proxies.PHP.LoadDesktop(n):e.Proxies.Node.LoadDesktop(n),e.UI.Dialogs.loadState.remove()},e.UI.ShowSaveDialog=function(t){var n=new THREEJS_WIDGET3D.Dialog({text:"State name:",buttonText:"Save",color:11978174,opacity:1});n.button_.addEventListener(WIDGET3D.EventType.onclick,e.UI.CloseSaveDialog,n),n.setZ(-1300),e.WIDGET.addToCameraGroup(n)},e.UI.CloseSaveDialog=function(t,n){n.textBox_.string_.length>0&&(e.UI.SaveDesktop(n.textBox_.string_),n.remove())},e.UI.ShowAbout=function(t){e.UI.Dialogs.about.show()}}(Lively3D),function(Lively3D){Lively3D.Proxies={},Lively3D.Proxies.PHP={ShowAppList:function(){$.get("getFileList.php",{path:"apps"},function(e){var t=JSON.parse(e);Lively3D.UI.createAppDialog(t)})},LoadApplication:function(e){Lively3D.FileOperations.getScript(e,"apps/"),Lively3D.UI.Dialogs.addApp.remove()},SaveDesktop:function(e){var t=Lively3D.GetApplications(),n="",r=[];for(var i in t)if(t.hasOwnProperty(i)){var s=t[i],o=s.isMaximized();s.isMaximized()==1&&s.Minimize();var u={Name:s.GetName(),Closed:s.isClosed(),Maximized:o,Code:s.GetApplicationCode().toString(),Init:s.GetInitializationCode().toString(),AppState:s.Save()};r.push(u),o==1&&s.Maximize()}n=JSON.stringify(r),Lively3D.FileOperations.uploadScript(e,n,"states/"+Lively3D.GetUsername())},LoadDesktop:function(e){Lively3D.FileOperations.getJSON(e,ParseDesktopJSON,"states/"+Lively3D.GetUsername()+"/")},ShowStateList:function(){$.get("getFileList.php",{path:"states/"+Lively3D.GetUsername()},function(e){var t=JSON.parse(e);Lively3D.UI.createStateDialog(t)})},ShowSceneList:function(){$.get("getFileList.php",{path:"world"},function(e){var t=JSON.parse(e);Lively3D.UI.createSceneDialog(t)})},LoadScene:function(e){Lively3D.FileOperations.getScript(e,"world/"),Lively3D.UI.Dialogs.loadScene.remove()}};var ParseDesktopJSON=function(data){var Applications=Lively3D.GetApplications(),appcount=Applications.length;for(var i=0;i<appcount;++i)Applications[0].GetIcon().remove(),Applications[0].GetWindowObject().remove(),Applications.splice(0,1);var JSONArray=JSON.parse(data);for(var i in JSONArray)if(JSONArray.hasOwnProperty(i)){var JSONObject=JSONArray[i],CodeFunc=eval("("+JSONObject.Code+")"),InitFunc=eval("("+JSONObject.Init+")"),app=Lively3D.AddApplication(JSONObject.Name,CodeFunc,InitFunc);app.StateFromDropbox=!0,JSONObject.Closed!=1&&(app.OpenAfterLoad=!0),JSONObject.Maximized==1&&(app.MaximizeAfterLoad=!0),app.Load(JSONObject.AppState),app.StartApp()}},SetAppLocation=function(e,t){e.GetSceneObject(0).setLocX(t.x),e.GetSceneObject(0).setLocY(t.y),e.GetSceneObject(0).setLocZ(t.z)},SetAppRotation=function(e,t){e.GetSceneObject(0).setRotX(t.x),e.GetSceneObject(0).setRotY(t.y),e.GetSceneObject(0).setRotZ(t.z)};Lively3D.Proxies.Node={ShowAppList:function(){$.get("/lively3d/node/filelist/apps",function(e){Lively3D.UI.createAppDialog(e)})},LoadApplication:function(e){$.get("/lively3d/node/file/apps/"+e,function(e){var t=document.createElement("script");t.type="text/javascript",t.src=e,document.head.appendChild(t)}),Lively3D.UI.Dialogs.addApp.remove()},SaveDesktop:function(e){var t=Lively3D.GetApplications(),n={};n.name=e,n.user=Lively3D.GetUsername(),n.applications=[];for(var r in t)if(t.hasOwnProperty(r)){var i=t[r],s=i.isMaximized();i.isMaximized()==1&&i.Minimize();var o={Name:i.GetName(),Closed:i.isClosed(),Maximized:s,Code:i.AppCode.toString(),Init:i.AppInit.toString(),AppState:i.Save()};n.applications.push(o),s==1&&i.Maximize()}$.post("/lively3d/node/states/new",{state:n},function(e){console.log(e)})},LoadDesktop:function(name){var Applications=Lively3D.GetApplications(),appcount=Applications.length;for(var i=0;i<appcount;++i)Applications[0].GetIcon().remove(),Applications[0].GetWindowObject().remove(),Applications.splice(0,1);$.get("/lively3d/node/states/"+Lively3D.GetUsername()+"/"+name,function(data){var apps=data.applications;for(var i in apps)if(apps.hasOwnProperty(i)){var JSONObject=apps[i],CodeFunc=eval("("+JSONObject.Code+")"),InitFunc=eval("("+JSONObject.Init+")"),app=Lively3D.AddApplication(JSONObject.Name,CodeFunc,InitFunc);app.StateFromDropbox=!0,JSONObject.Closed!="true"&&(app.OpenAfterLoad=!0),JSONObject.Maximized=="true"&&(app.MaximizeAfterLoad=!0),app.Load(JSONObject.AppState),app.StartApp()}})},ShowStateList:function(){$.get("/lively3d/node/states/"+Lively3D.GetUsername(),function(e){Lively3D.UI.createStateDialog(e)})},ShowSceneList:function(){$.get("/lively3d/node/filelist/world",function(e){Lively3D.UI.createSceneDialog(e)})},LoadScene:function(e){$.get("/lively3d/node/file/world/"+e,function(e){var t=document.createElement("script");t.type="text/javascript",t.src=e,document.head.appendChild(t)}),Lively3D.UI.Dialogs.loadScene.remove()}},Lively3D.Proxies.Local={ShowAppList:function(){$.ajax({url:"http://127.0.0.1:8000/filelist/apps",success:function(e){Lively3D.UI.createAppDialog(e)}})},LoadApplication:function(e){$.get("http://127.0.0.1:8000/file/apps/"+e,function(e){var t=document.createElement("script");t.type="text/javascript",t.src=e,document.head.appendChild(t)}),Lively3D.UI.Dialogs.addApp.remove()},ShowSceneList:function(){$.get("http://localhost:8000/filelist/world",function(e){Lively3D.UI.createSceneDialog(e)})},LoadScene:function(e){$.get("http://localhost:8000/file/world/"+e,function(e){var t=document.createElement("script");t.type="text/javascript",t.src=e,document.head.appendChild(t)}),Lively3D.UI.Dialogs.loadScene.remove()},CheckAvailability:function(e){$.ajax({url:"http://localhost:8000/",success:function(t){t.success==0?alert(t.message):e()},error:function(){alert("Local Node.js application not found. Please run 'node local.js'")}})},Sync:function(e){$.ajax({url:"http://localhost:8000/sync",data:{host:window.location.host,port:window.location.port,path:window.location.pathname},success:function(e){e.success==1&&alert(e.message)},error:function(){alert("Local Node.js application not found. Please run 'node local.js' and associated Mongo-database.")}})},LoadResources:function(e,t){$.get("http://localhost:8000/filearray",{"names[]":e.Resources[t],path:e.ResourcePath},function(n){e.ResourceHandlers[t](n),e.ResourcesLoaded(t)})}}}(Lively3D)